#                                    哪种拓扑的可靠性高？                                                                                                   A.总线      B.星型      C.环形       **D.网状**

## 回顾六种不同的拓扑结构

### **总线型**

![img](https://pic1.zhimg.com/v2-0763eb74466da9b579d55e08d04967c8_b.webp?consumer=ZHI_MENG)

**总线型拓扑结构的网络特点如下：**

结构简单，可扩充性好；

当需要增加节点时，只需要在总线上增加一个分支接口便可与分支节点相连，当总线负载不允许时还可以扩充总线；

使用的电缆少，且安装容易；

使用的设备相对简单，可靠性高；

维护难，分支节点故障查找难。

**总线型拓扑结构的结构特点如下**：

(1)`组网费用低`：从示意图可以这样的结构根本不需要另外的互联设备，是直接通过一条总线进行连接，所以组网费用较低；

(2)这种网络因为各节点是共用总线带宽的，所以在`传输速度上会随着接入网络的用户的增多而下降`；

(3)`网络用户扩展较灵活`：需要扩展用户时只需要添加一个接线器即可，但所能连接的用户数量有限；

(4)维护较容易：`单个节点失效不影响`整个网络的正常通信。`但是如果总线一断，则整个网络或者相应主干网段就断了`。

(5)这种网络拓扑结构的缺点是`一次仅能一个端用户发送数据`，其它端用户必须`等待到获得发送权`。





### **星型**



![img](https://pic2.zhimg.com/v2-37545bc08bfccda3a8df232ea34aac19_b.webp?consumer=ZHI_MENG)



星型拓扑，也称为中心辐射型拓扑，使用中央节点——通常是路由器或第2层或第3层交换机。与将传输的帧简单地广播到所有连接的端点的总线拓扑不同，星形拓扑使用具有`额外内置智能级别的组件`。

第2层交换机在星型拓扑部署中维护动态媒体访问控制 (MAC) 地址表。该表将设备的MAC地址映射到其连接的物理交换机端口。当数据包传输到LAN上的特定MAC地址时，交换机会执行MAC地址表查找以确定帧的目标端口。这显着减少了可能造成瓶颈的不必要的广播流量。

使用第3层设备作为星形拓扑中心节点可以使IP寻址和路由表以流量转发为目标并将其发送到单个目的地。

**星型拓扑结构的结构特点如下**：

(1)控制简单。任何一站点只和中央节点相连接，因而介质访问控制方法简单，致使访问协议也十分简单。易于网络监控和管理。

(2)`故障诊断和隔离容易`。中央节点对连接线路可以逐一隔离进行故障检测和定位，单个连接点的故障只影响一个设备，不会影响全网。

(3)方便服务。中央节点可以方便地对各个站点提供服务和网络重新配置。

总的来说星型拓扑结构相对简单，便于管理，建网容易，是目前局域网普采用的一种拓扑结构。采用星型拓扑结构的局域网，一般使用双绞线或光纤作为传输介质，符合综合布线标准，能够满足多种宽带需求。

尽管物理星型拓扑的实施费用高于物理总线拓扑，然而星型拓扑的优势却使其物超所值。每台设备通过各自的线缆连接到中心设备，因此`某根电缆出现问题时只会影响到那一台设备，而网络的其他组件依然可正常运行`。这个优点极其重要，这也正是所有新设计的以太网都采用的物理星型拓扑的原因所在。





### **环形**

环形结构各结点通过通信线路组成`闭合回路`，`环中数据只能单向传输`，信息在每台设备上的延时时间是固定的，特别`适合实时控制的局域网系统`。环形结构就如一串珍珠项链,环形结构上的每台计算机就是项链上的一个个珠子。

![img](https://pic1.zhimg.com/v2-d90cfca3e24ce851deeee6bb931fb374_b.webp?consumer=ZHI_MENG)



实际上大多数情况下这种拓扑结构的网络不会是所有计算机真的要连接成物理上的环型，一般情况下，环的两端是通过一个阻抗匹配器来实现环的封闭的，因为在实际组网过程中因地理位置的限制不方便真的做到环的两端物理连接。

**环型拓扑结构的网络特点如下**：

`信息流在网中是沿着固定方向流动的`，两个节点仅有一条道路，故简化了路径选择的控制；

环路上各节点都是自举控制，故控制软件简单；

由于信息源在环路中是串行地穿过各个节点，当环中节点过多时，势必影响信息传输速率，使网络的响应时间延长；

`环路是封闭的，不便于扩充`；

`可靠性低，一个节点故障，将会造成全网瘫痪；`

`维护难`，对分支节点故障定位较难。

**环型拓扑结构的结构特点如下**：

(1)这种网络结构一般仅适用于IEEE 802.5的令牌网(Token ring network)，在这种网络中，"令牌"是在环型连接中依次传递。所用的传输介质一般是同轴电缆。

(2)这种网络实现也非常简单，投资最小。可以从其网络结构示意图中看出，组成这个网络除了各工作站就是传输介质--同轴电缆，以及一些连接器材，没有价格昂贵的节点集中设备，如集线器和交换机。但也正因为这样，所以这种网络所能实现的功能最为简单，仅能当作一般的文件服务模式；

(3)传输速度较快：在令牌网中允许有16Mbps的传输速度，它比普通的10Mbps以太网要快许多。当然随着以太网的广泛应用和以太网技术的发展，以太网的速度也得到了极大提高，目前普遍都能提供100Mbps的网速，远比16Mbps要高。

(4)维护困难：从其网络结构可以看到，整个网络各节点间是直接串联，这样任何一个节点出了故障都会造成整个网络的中断、瘫痪，维护起来非常不便。另一方面因为同轴电缆所采用的是插针式的接触方式，所以非常容易造成接触不良，网络中断，而且这样查找起来非常困难，这一点相信维护过这种网络的人都会深有体会。

(5)扩展性能差：也是因为它的环型结构，决定了它的扩展性能远不如星型结构的好，如果要新添加或移动节点，就必须中断整个网络，在环的两端作好连接器才能连接。







### **树形**

树形拓扑是一种层次结构，当以网络图的形式绘制时，节点像树一样链接和排列。网络专业人员通常会部署具有核心层、分布层和接入层的树形拓扑。

树的`顶部是核心层`，它负责从网络的一个部分到另一个部分的高速传输。树中间的分布层执行与核心类似的传输职责，但在更本地化的级别上。分布层也是网络管理员应用访问控制列表和服务质量策略的地方。树的底部是访问层，端点设备在此连接到网络。

叶脊网络拓扑是一种树形拓扑，在数据中心越来越流行。叶脊拓扑坚持树的层次结构e 模型但只有两层，而不是传统的三层。 叶脊网络交换机组件负责整个数据中心的高速传输; 叶交换机与主干节点完全匹配，负责将应用程序、数据库和存储服务器连接到数据中心。

![img](https://pic1.zhimg.com/v2-90428d7fc6308e69b11dd6221f10c954_b.webp?consumer=ZHI_MENG)

**树形拓扑结构的网络特点如下：**

网络结构简单，便于管理；

控制简单，建网容易；

网络延迟时间较短，误码率较低；

`网络共享能力和数据承载能力较差；`

```
树形拓扑的网络共享能力较差的原因包括：
中心依赖性：树形网络的共享能力通常受限于根节点或核心交换机的性能和带宽。如果根节点或中心交换设备出现故障或带宽耗尽，会影响到整个网络的数据共享和通信能力。
分层限制：因为是层级结构，树形网络中的数据通常需要经过多个中转点才能到达目的地。数据在传输过程中，每通过一级节点都可能导致延迟增加，并有可能遭遇瓶颈，这降低了网络资源的共享效率。
带宽分配：在较低层次的节点中，带宽被多设备共享，一旦某个节点的数据传输需求增加，可能会抢占其他节点的带宽资源。这种竞争关系通常导致网络性能下降，特别是在高流量时段。
故障扩散：在树形结构中，高层次节点的故障可以迅速影响整个下属分支网络的共享能力。而且，因为单点故障可能导致大面积的网络失效，所以树形拓扑在故障恢复和维护上相比扁平化的网络也更为复杂。
综上所述，树形结构网络因中心化设计和分层传输特性导致其在数据共享能力上有一定局限性。
```

通信线路利用率不高；

中央结点负荷太重。

**树型拓扑结构的结构特点如下**：

(1)易于扩充。树形结构可以延伸出很多分支和子分支，这些新节点和新分支都能容易地加入网内。

(2)故障隔离较容易。如果某一分支的节点或线路发生故障，很容易将故障分支与整个系统隔离开来。

(3)各个节点对根节点的依赖性太大。如果根发生故障，则全网不能正常工作。





### **网状**

网状拓扑是另一种非分层结构，其中每个网络节点直接连接到所有其他节点。`网状拓扑确保了巨大的网络弹性`，因为如果连接断开，既不会发生中断也不会丢失连接。相反，流量只是沿着不同的路径重新路由。

然而，使用网状拓扑的`缺点是它增加了架构的复杂性`。如果网格使用有线链路，这也会显着增加所需的网络电缆数量。为避免布线问题，企业通常将网状网络归入无线系统，例如基于Wi-Fi的网状部署。

![img](https://pic3.zhimg.com/v2-b41c266257229f887f4ffb3c72a09f82_b.webp?consumer=ZHI_MENG)



**网状网络拓扑结构的结构特点如下：**

(1) `网络可靠性高`，`一般通信子网中任意两个节点交换机之间，存在着两条或两条以上的通信路径，这样，当一条路径发生故障时，还可以通过另一条路径把信息送至节点交换机。`

(2) 网络可组建成各种形状，采用多种通信信道，多种传输速率。

(3) 网内节点共享资源容易。

(4) 可改善线路的信息流量分配。

(5) 可选择最佳路径，传输延迟小。

网状形网是广域网中最常采用的一种网络形式，是典型的点到点结构。在网状拓扑结构中，网络的每台设备之间均有点到点的链路连接，这种连接不经济，只有每个站点都要频繁发送信息时才使用这种方法。`它的安装也复杂，但系统可靠性高，容错能力强。有时也称为分布式结构。`







### **混合网络结构**

混合型网络拓扑结构就是指同时使用上面的5种网络拓扑结构种两种或两种以上的网络拓扑结构。

这种网络拓扑结构是由星型结构和总线型结构的网络结合在一起的网络结构，这样的拓扑结构更能满足较大网络的拓展，解决星型网络在传输距离上的局限，而同时又解决了总线型网络在连接用户数量的限制。这种网络拓扑结构同时兼顾了星型网与总线型网络的优点，在缺点方面得到了一定的弥补。

**混合型网络拓扑结构的结构特点如下：**

(1)应用广泛
这主要是因它解决了星型和总线型拓扑结构的不足，满足了大公司组网的实际需求。目前在一些智能化的信息大厦中的应用非常普遍。在一幢大厦中，各楼层间采用光纤作为总线传输介质，一方面可以保证网络传输距离，另一方面，光纤的传输性能要远好于同轴电缆， 所以，在传输性能上也给予了充分保证。当然投资成本会有较大增加，在一些较小建筑物中 也可以采用同轴电缆作为总线传输介质。各楼层内部仍普遍采用使用双绞线星型以太网。

(2)扩展灵活
这主要是继承了星型拓扑结构的优点。但由于仍采用广播式的消息传送方式，所以在总 线长度和节点数量上也会受到限制，不过在局域网中的影响并不是很大。

(3)性能差
因为其骨干网段(总线段)采用总线网络连接方式，所以各楼层和各建筑物之间的网络 互联性能较差，仍局限于最高1 6Mbps的速率。另外，这种结构网络具有总线型网络结构的 弱点，网络速率会随着用户的增多而下降。当然在采用光纤作为传输介质的混合型网络中， 这些影响还是比较小的。

(4)较难维护
这主要受到总线型网络拓扑结构的制约，如果总线断，则整个网络也就瘫痪了，但是如果是分支网段出了故障，则不影响整个网络的正常运作。再一个就是整个网络非常复杂，维 护起来不容易。

































# 下面哪个不是网络层协议： ICMP IGMP **ARP** DHCP

ARP (地址解析协议，Address Resolution Protocol) 不属于网络层协议。ARP 主要用于将网络层的IP地址转换成链路层的物理地址（MAC地址），因此它主要工作在数据链路层。

回顾几种重要协议：

## **ICMP (Internet Control Message Protocol)**

1）ICMP协议，即：网络控制消息协议（Internet Control Message Protocol）

2）ICMP是网络层协议，因为ICMP报文是装在IP数据报中，作为它的数据部分发出去的，如图

3）ICMP协议用于**报告网路差错和异常**，如：`网络通不通、主机是否可达、路由是否可用等`

4）ICMP报文有两种类型：ICMP差错报告报文和ICMP询问报文

<img src="https://img2018.cnblogs.com/blog/1448880/201902/1448880-20190224144828188-228684550.png" alt="img" style="zoom: 67%;" />

<img src="https://img2018.cnblogs.com/blog/1448880/201903/1448880-20190322094331265-1080721005.png" alt="img" style="zoom: 50%;" />



### 应用

1）ICMP的一个重要应用就是分组网间探测PING（Packet Internet Groper），用来测试主机之间的连通性

2）PING使用了ICMP回送请求与回送回答报文（属于**ICMP询问报文**）

3）PING直接使用网络层ICMP协议，**没有通过运输层层的TCP或UDP**

#### ping一个域名的全过程（跨网段）

1）DNS域名解析，获得IP地址

2）ARP协议地址解析，获得MAC地址

3）主机将ICMP报文封装成IP数据报

4）主机将IP数据报封装成MAC帧

5）主机将MAC帧发送至相应路由器

6）路由器接收到ICMP报文之后，发现MAC帧的目的地址是自己，IP地址是主机想要访问的外网段IP地址，则要修改MAC帧的地址（如有必要，路由器再次进行ARP），再进行[NAT](https://www.cnblogs.com/Joezzz/p/10182093.html)，再把数据包转发出去

7）域名主机收到ICMP请求报文后，会重新构建一个ICMP应答报文，然后返回给主机

8）当主机收到域名主机发送的ICMP应答报文之后，这样就表明该主机到域名主机是连通可达的







## IGMP(Internet Group Management Protocol)

### 定义

IGMP，被称为互联网组管理协议，是TCP/IP协议族中负责**IPV4组播成员管理的协议**。

### IGMP的作用

-  作用1 IGMP用来在接收者主机和直接相邻的组播路由器之间建立和维护组播组成员的关系。 
-  作用2 IGMP通过`在接收者主机和组播路由器之间交互IGMP报文`实现**组成员管理功能**，IGMP报文封装在IP报文中。 



<img src="https://ask.qcloudimg.com/http-save/yehe-8223537/4b24ea10730fe5f3e507d00813561682.png" alt="在这里插入图片描述" style="zoom:50%;" />



### 什么是互联网组管理协议 (IGMP)？

互联网组管理协议 (IGMP) 是允许多个设备共享一个 IP 地址以便它们可以接收相同数据的协议。IGMP 是一个网络层[协议](https://www.cloudflare.com/learning/network-layer/what-is-a-protocol/)，用于在使用[互联网协议](https://www.cloudflare.com/learning/network-layer/internet-protocol/)版本 4 (IPv4) 的网络上设置多播。具体来说，IGMP 允许设备加入一个多播组。

### 什么是多播？

多播是指一组设备都接收相同的消息或[数据包](https://www.cloudflare.com/learning/network-layer/what-is-a-packet/)。多播通过在多个设备之间共享 IP 地址来运作。指向该 [IP 地址](https://www.cloudflare.com/learning/dns/glossary/what-is-my-ip-address/)的任何网络流量都将到达共享该 IP 地址的所有设备，而不仅仅是一台设备。这很像一组员工都收到针对某个电子邮件别名的公司电子邮件。

### IGMP 如何运作？

连接到网络的计算机和其他设备在想要加入多播组时使用 IGMP。支持 IGMP 的路由器侦听来自设备的 IGMP 传输，以确定哪些设备属于哪些多播组。

IGMP 使用为多播预留的 IP 地址。多播 IP 地址在 224.0.0.0 和 239.255.255.255 之间的范围内。（相比之下，Anycast 网络可以使用任何常规 IP 地址。）每个多播组共享其中一个 IP 地址。当路由器接收到一系列指向该共享 IP 地址的数据包时，它将复制这些数据包，将副本发送给多播组的所有成员。

IGMP 多播组可以随时更改。设备可以在任何时候发送 IGMP“加入组”或“离开组”消息。

IGMP 直接在互联网协议 (IP) 之上工作。每个 IGMP 数据包都有一个 IGMP 标头和一个 IP 标头。就像 [ICMP](https://www.cloudflare.com/learning/ddos/glossary/internet-control-message-protocol-icmp/)一样，IGMP 不使用 [TCP](https://www.cloudflare.com/learning/ddos/glossary/tcp-ip/) 或 [UDP](https://www.cloudflare.com/learning/ddos/glossary/user-datagram-protocol-udp/) 之类的传输层协议。

### IGMP应用场景

IGMP最常见的应用是IPTV：

-  视频源端发送UDP组播数据流，客户端通过加入组播接收数据流播放节目 
-  Client 发送IGMP Join Group封包加入组播才能接收到数据 

![在这里插入图片描述](https://ask.qcloudimg.com/http-save/yehe-8223537/5021febcb9ac2ab5af9a0d58acea1a90.png)

在这里插入图片描述

-  Client不想要接收此组播数据时,发送一个IGMP Leave Group封包离开组播 

![在这里插入图片描述](https://ask.qcloudimg.com/http-save/yehe-8223537/089ad28c6686325bd3a383060ae09c6a.png)











## **ARP**(Address Resolution Protocol)

### 概念

1） 地址解析协议ARP的作用就是根据目的主机的IP地址来获得其物理地址，因为将IP数据报封装到MAC帧里面的时候需要知道目的地址的MAC地址

2）ARP协议介于数据链路层和网络层之间

3）每个主机都设有一个ARP高速缓存（ARP cache），这里面放着的是主机已经知道的IP地址和MAC地址的映射表，并且这个映射表是动态更新的

### ARP协议的工作原理

　　当主机A想要同本局域网上的某个主机B发送IP数据报时，就先在其ARP高速缓存中查看有无主机B的IP地址。如果有，就在ARP高速缓存中查找器对于的硬件地址，再把这个硬件地址写入MAC帧里，然后通过局域网把MAC帧发往此硬件地址。也有可能在ARP高速缓存中查不到主机B的IP地址（主机A缓存为空，或主机B刚加入局域网），这样也就无法知道主机B的MAC地址，这时候就需要使用到ARP了，按以下步骤来获得主机B的硬件地址。

1）主机A的ARP进程在本局域网上广播发送一个ARP请求分组，以广播的形式，格式如图a所示

2）在本局域网上的所有主机上运行的ARP进程都受到了这个ARP请求分组

3）主机B在ARP请求分组中发现了自己的IP地址，就向A主机发送ARP响应分组，以单播的形式直接发给A，以如图b所示。同时主机B知道了A的IP地址和MAC地址，就将主机A的IP地址和MAC地址写入ARP高速缓存中。其他主机在对比IP地址之后，发现与自己的IP地址不同，就丢掉分组

4）主机A收到主机B的ARP响应分组之后，这样就知道了主机B的MAC地址，同时把主机B的IP地址和MAC地址写入ARP**高速缓存**



<img src="https://img2018.cnblogs.com/blog/1448880/201902/1448880-20190224153725832-559660179.png" alt="img" style="zoom: 50%;" />

### RARP（Reverse Address Resolution Protocol）

1）RARP反向地址转换协议，由物理地址来获得IP地址，使只知道自己硬件地址的主机能够知道自己的 IP 地址

2）通常用在[无盘工作站](https://baike.baidu.com/item/无盘工作站/945496?fr=aladdin)，则需要RARP方法来获得IP地址









## **DNS(domain name system)**

### 概念

1）域名系统DNS（Domain Name System），用于域名和IP地址的相互转换

2）DNS使用UDP传输（为了减少开销），端口53

![img](https://img2018.cnblogs.com/blog/1448880/201902/1448880-20190224160526843-1740901000.png)

![img](https://img2018.cnblogs.com/blog/1448880/201902/1448880-20190224161049111-968131308.png)

### DNS域名服务器的分类

1）根域名服务器：是最高层次的域名服务器，全球只有13台，根域名服务器知道所有顶级域名服务器的域名和IP地址

2）顶级域名服务器：顶级域名服务器以顶级域名来命名，负责管理在该顶级域名服务器上注册的所有二级域名，例如com顶级域名服务器管理所有以“.com”为后缀的域名

3）权限域名服务器：负责一个区的域名

4）本地域名服务器：当一个主机发出DNS查询请求时，首先就发给本地域名服务器

![img](https://img2018.cnblogs.com/blog/1448880/201902/1448880-20190224160837088-371644096.png)

### 递归查询

1）主机向本地域名服务器的查询一般都是采用递归查询

2）所谓递归查询就是：如果主机所询问的本地域名服务器不知道被查询的域名的IP地址，那么**本地域名服务器**就以DNS客户的身份，向其它根域名服务器继续发出查询请求报文(即**替主机继续查询**)，而不是让主机自己进行下一步查询

### 迭代查询

1）本地域名服务器向根域名服务器的查询的迭代查询

2）迭代查询的特点：当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地服务器：“你下一步应当向哪一个域名服务器进行查询”。然后让本地服务器进行后续的查询。（而**不是替本地域名服务器进行后续的查询**）

3）本地域名服务器**也可以采用**递归查询，这取决于用户设置

### DNS域名解析基本过程

![img](https://img2018.cnblogs.com/blog/1448880/201902/1448880-20190224161447529-1056473009.png)

假定域名为m.xyz.com的主机想知道另一个主机y.abc.com的IP地址，下面是上图a的几个查询步骤：

　　 1、主机先从本机的**DNS缓存**，**Hosts文件**中寻找，如果找不到，则再进行下列操作

​    2、主机m.xyz.com先向本地域名服务器dns.xyz.com进行**递归查询**。

​    3、本地域名服务器若没有，则采用迭代查询。它先向一个根域名服务器查询。

​    4、根域名服务器告诉本地服务器，下一次应查询的顶级域名服务器dns.com的IP地址。

​    5、本地域名服务器向顶级域名服务器dns.com进行查询。

​    6、顶级域名服务器dns.com告诉本地域名服务器，下一步应查询的权限服务器dns.abc.com的IP地址。

​    7、本地域名服务器向权限域名服务器dns.abc.com进行查询。

​    8、权限域名服务器dns.abc.com告诉本地域名服务器，所查询的主机的IP地址。

​    9、本地域名服务器最后把查询结果告诉m.xyz.com。

整个查询过程共用到了8个UDP报文

### DNS劫持

1）概念：DNS劫持又称域名劫持，是指DNS客户发送的域名解析的请求被拦截了，拦截这分析请求的域名，返回一个假的域名解析结果，导致主机对该域名的访问转入到修改后的假IP，其结果就是对特定的网址不能访问或访问的是假网址

2）解决：

- 如果直到IP地址，直接用IP地址访问
- 更换可靠的DNS服务器











## DHCP

动态主机配置协议（Dynamic Host Configuration Protocol， DHCP）是一种网络管理协议，运行在Internet协议（IP）网络上自动将IP地址和其他通信参数分配至客户端。目前DHCP主要有DHCPv4（IPv4）和DHCPv6（IPv6）。



### 一、概述

DHCP基于`Cline-Server`模型运行，数据交互采用无连接服务模型，使用UDP协议进行数据交互（UDP /67是服务器使用的端口，UDP/68是客户端使用的端口）。当计算机或其他设备连接到网络时，DHCP客户端将会发送DHCP广播查询，请求必要的信息。网络上的任何DHCP服务器都可以为该请求进行回复并提供服务。在收到DHCP请求时，DHCP服务器可能会响应每个客户端的特定信息，或使用特定地址对整个网络进行响应（租约、IP地址、DNS等信息）。

DHCP分配三种方式：

1. 动态分配：管理员为DHCP保留一系列IP地址。但此时原理员为每个DHCP客户端暂时分配了一个IP地址，并为这个IP地址设置了一定的租约时间。当这个租约到期后，这个IP地址就会返还给DHCP服务器。
2. 自动分配：DHCP服务器从管理员定义范围内的IP地址永久分配给客户端。这种分配类似于动态分配，但是这种分配会在DHCP分配会在DHCP服务器上保留一个IP地址分配表，这样以便后期客户端拥有以前相同的IP地址。
3. 手工分配：这种分配方式将在DHCP上将IP/MAC地址进行绑定。管理员将每个客户端的唯一标识符映射到请求客户端的IP地址。



### 二、DHCP角色

![img](https://img2022.cnblogs.com/blog/1253675/202209/1253675-20220929171555104-4398011.png)

DHCP服务器：DHCP服务器负责从地址池中选择IP地址分配给DHCP客户端，还为DHCP客户端提供其他网络参数。

DHCP客户端：客户端发送DHCP请求报文获取相关网络参数。

DHCP中继：DHCP中继负责转发DHCP服务器和DHCP客户端之间的DHCP报文，协助DHCP服务器向DHCP客户端动态分配网络参数。



### 三、DHCP报文

DHCP服务器与DHCP客户端之间通过DHCP报文进行通信。DHCP报文是基于UDP协议传输的。DHCP客户端向DHCP服务器发送报文时采用68端口号，DHCP服务器向DHCP客户端发送报文时采用67端口号。

| 报文名称      | 说明                                                         |
| ------------- | ------------------------------------------------------------ |
| DHCP DISCOVER | DHCP客户端首次登录网络时进行DHCP交互过程发送的第一个报文，用来寻找DHCP服务器。 |
| DHCP OFFER    | DHCP服务器用来响应DHCP DISCOVER报文，此报文携带了各种配置信息。 |
| DHCP REQUEST  | 此报文用于以下三种用途。客户端初始化后，发送广播的DHCP REQUEST报文来回应服务器的DHCP OFFER报文。客户端重启后，发送广播的DHCP REQUEST报文来确认先前被分配的IP地址等配置信息。当客户端已经和某个IP地址绑定后，发送DHCP REQUEST单播或广播报文来更新IP地址的租约。 |
| DHCP ACK      | 服务器对客户端的DHCP REQUEST报文的确认响应报文，客户端收到此报文后，才真正获得了IP地址和相关的配置信息。 |
| DHCP NAK      | 服务器对客户端的DHCP REQUEST报文的拒绝响应报文，例如DHCP服务器收到DHCP REQUEST报文后，没有找到相应的租约记录，则发送DHCP NAK报文作为应答，告知DHCP客户端无法分配合适IP地址。 |
| DHCP DECLINE  | 当客户端发现服务器分配给它的IP地址发生冲突时会通过发送此报文来通知服务器，并且会重新向服务器申请地址。 |
| DHCP RELEASE  | 客户端可通过发送此报文主动释放服务器分配给它的IP地址，当服务器收到此报文后，可将这个IP地址分配给其它的客户端。 |
| DHCP INFORM   | DHCP客户端获取IP地址后，如果需要向DHCP服务器获取更为详细的配置信息（网关地址、DNS服务器地址），则向DHCP服务器发送DHCP INFORM请求报文。 |



### 四、交互过程



#### 1、无中继场景是DHCP客户端首次接入网络的工作原理

![img](https://img2022.cnblogs.com/blog/1253675/202209/1253675-20220929171614139-1197379224.png)

##### 1）第一步：发现阶段

首次接入网络的DHCP客户端不知道DHCP服务器的相关信息，为了学习到DHCP服务器的IP地址，DHCP客户端以广播方式发送DHCP DISVOER报文（目的IP地址为255.255.255.255）给同一网段内的所有设备。

##### 2）第二步：提供阶段

与DHCP客户端位于同一LAN的DHCP服务器都将收到DHCP DISCOVER包围，DHCP服务器选择跟接收DHCP DISCOVER报文接口的IP地址处于同一网段的地址，并从中选择一个可用的IP地址，然后通过DHCP OFFER报文发送给客户端。

##### 3）第三步：选择阶段

如果有多个DHCP服务器向DHCP客户端回应DHCP OFFER报文，则DHCP客户端一般只接收第一个收到的DHCP OFFER报文，然后以广播方式发送DHCP REQUEST报文，该报文中包含客户端想要选择的DHCP服务器表示和客户端IP地址。

```
DHCP客户端广播发送DHCP REQUEST报文通知所有的DHCP服务器，它将选择某个DHCP服务器提供的IP地址，其他DHCP服务器可以重新将曾经分配给客户端的IP地址分配给其他客户端。
```

##### 4）第四步：确认阶段

当DHCP服务器收到DHCP客户端发送的DHCP REQUEST报文后，DHCP服务器回应DHCP ACK报文，表示DHCP REQUEST报文中请求的IP地址分配给客户端使用。

DHCP客户端收到DHCP ACK报文后，会广播发送免费ARP报文，探测本网段是否有其他终端使用服务器分配的IP地址，如果没有客户端则使用该地址，如果有则客户端向DHCP服务器发送DHCP DECLINE报文并重新请求IP地址。DHCP在收到DHCP DECLINE报文后，会将此地址标记为冲突地址。



#### 2、有中继场景时DHCP客户端首次接入网络的工作原理

![img](https://img2022.cnblogs.com/blog/1253675/202209/1253675-20220929171630529-1536900965.png)

有DHCP中继的场景中，首次接入网络的DHCP客户端和DHCP服务器的工作原理与无中继场景时DHCP客户端首次接入网络的工作原理相同。主要差异是DHCP中继在DHCP服务器和DHCP客户端之间转发DHCP报文，以保证DHCP服务器和DHCP客户端可以正常交互。



### 五、攻击手段



#### 1、DHCP Server仿冒攻击

由于DHCP Server和DHCP Client之间没有认证机制，所以如果在网络上随意添加一台DHCP服务器，它就可以为客户端分配IP地址以及其他网络参数。进而可以被攻击者利用给与客户端错误的DHCP参数。



#### 2、DHCP泛洪攻击

向DHCP服务器发送大量DHCP请求数据报文，使得DHCP Server系统资源耗尽，导致其他合法的DHCP交互无法正常使用。



#### 3、DHCP 饿死攻击

攻击者伪造chaddr（DHCP客户端硬件地址）字段各不相同的DHCP请求报文，向DHCP服务器申请大量的IP地址，进而导致DHCP服务器地址池地址耗尽，无法为合法的DHCP客户端分配地址。



#### 4、伪造DHCP请求方向报文攻击

攻击者非法伪造DHCP续约报文、DHCP DECLINE和DHCP RELEASE三种DHCP请求报文对DHCP服务进行攻击。

1. 伪造DHCP续约报文攻击是指攻击者冒充合法的DHCP客户端，向DHCP服务器发送伪造的DHCP续约报文，导致DHCP服务器和DHCP客户端无法按照自己的意愿及时释放IP地址租约。如果攻击者冒充不同的DHCP客户端发送大量伪造的DHCP续约报文，则会导致大量IP地址被长时间占用，DHCP服务器没有足够的地址分配给新的DHCP客户端。
2. 伪造DHCP DECLINE/DHCP RELEASE报文攻击是指攻击者冒充合法的DHCP客户端，向DHCP服务器发送伪造的DHCP DECLINE/DHCP RELEASE报文，导致DHCP服务器错误终止IP地址租约。



### 六、DHCP防范技术

DHCP Snooping是DHCP的一种安全特性，用于保证DHCP客户端从合法的DHCP服务器获取IP地址，并纪律DHCP客户端IP地址与MAC地址等参数的对应关系。DHCP Snooping可以抵御网络中针对DHCP的各种攻击，为用户提供更安全的网络环境和更稳定的网络服务。



#### DHCP Snooping构成

##### 1）DHCP Snooping信任功能

DHCP Snooping的信任功能，能够保证客户端从合法的服务器获取IP地址。DHCP Snooping信任功能可以控制DHCP服务器应答报文的来源，以防止网络中可能存在的DHCP Server仿冒者为DHCP客户端分配IP地址及其他配置信息。

DHCP Snooping新人功能将接口分为信任接口和非信任接口：

1. 信任接口正常接收DHCP服务器响应的DHCP ACK、DHCP NAK和DHCP Offer报文；
2. 非信任接口在接收到DHCP服务器响应的DHCP ACK、DHCPNAK和DHCP Offer报文后，会丢弃该报文；

##### 2）DHCP Snooping绑定表

DHCP Snooping绑定表根据DHCP租期进行老化或根据用户释放IP地址时发出的DHCP Release报文自动删除对应表项。由于DHCP Snooping绑定表记录了DHCP客户端IP地址与MAC地址等参数的对应关系，故通过对报文与DHCP Snooping绑定表进行匹配检查，能够有效防范非法用户的攻击。